"use strict";$(function(){function e(l){var s=JSON.parse(localStorage.getItem("userData"));if(s)var o="1003/userData/"+s.id;else o="1002/data";$.get("http://localhost:1001/main3",function(e){var n="",a=document.createElement("ul");$(l).each(function(t){$(e).each(function(a){l[t].id==e[a].id&&(n+='\n                        <li>\n                            <a href="javasript:">\n                                <input type="checkbox" class="ensure">\n                                <img src="../'+e[a].src+'" class="prodImg" />\n                                \n                                <span class="title">'+e[a].title+'</span>\n                                <span class="price" data-price="'+e[a].price+'">￥'+e[a].price+'</span>\n                                <div class="numBtn">\n                                <button class="addBtn"><i class="iconfont icon-jjia-"></i></button>\n                                    <input type="text" class="addnum" value="'+l[t].num+'" />\n                                <button class="subBtn"><i class="iconfont icon-ziyuan"></i></button>\n                                </div>\n                                <span class="allPrice" price-all="'+l[t].price+'">￥'+l[t].price+'</span>\n                                <input class="delBtn" value="删除" data-id="'+l[t].id+'" />\n                            </a>\n                        </li>')})});function c(){$.get("http://localhost:"+o,function(t){var e=[];s&&(t=JSON.parse(t.cartData)),$(t).each(function(a){t[a].price&&e.push(t[a].price)});var n=0;$(".ensure").each(function(a){$(".ensure").eq(a).prop("checked")&&(n+=Number(e[a]))}),$("#allPrice span").text("￥"+n)})}$(a).html(n+'<label class="allCheck">\n                <input type="checkbox">全选</label>\n                <input type="button" value="去结算" class="pay" />\n                <p id="allPrice">总价：<span>￥0</span></p>\n                '),$(".content").html($(a)),$(".delBtn").click(function(){var t=$(this).attr("data-id");s?$.get("http://localhost:"+o,function(a){a=(a=JSON.parse(a.cartData)).filter(function(a){return a.id!=t}),a=JSON.stringify(a),console.log(a),console.log(a),$.ajax({type:"patch",url:"http://localhost:"+o,data:{cartData:a},success:function(){c()}})}):$.ajax({type:"Delete",url:"http://localhost:"+o+"/"+t,data:{},success:function(){$.get("http://localhost:"+o,function(a){c()})}}),$(this).parent().parent().detach()}),$(".addBtn").each(function(n){$(".addBtn").eq(n).click(function(){$(".addnum").eq(n).val(+$(".addnum").eq(n).val()+1);var t=$(".delBtn").eq(n).attr("data-id"),e=$(".price").eq(n).attr("data-price");$(".allPrice").eq(n).text("￥"+$(".addnum").eq(n).val()*e),$.get("http://localhost:"+o,function(a){s?((a=JSON.parse(a.cartData))[n].price=$(".addnum").eq(n).val()*e,a[n].num=$(".addnum").eq(n).val(),a=JSON.stringify(a),console.log(a),$.ajax({type:"patch",url:"http://localhost:"+o,data:{cartData:a},success:c})):$.ajax({type:"put",url:"http://localhost:"+o+"/"+t,data:{num:$(".addnum").eq(n).val(),price:$(".addnum").eq(n).val()*e},success:c})})}),$(".subBtn").eq(n).click(function(){if(console.log(n),1<$(".addnum").eq(n).val()){$(".addnum").eq(n).val($(".addnum").eq(n).val()-1);var t=$(".price").eq(n).attr("data-price"),e=$(".delBtn").eq(n).attr("data-id");$(".allPrice").eq(n).text("￥"+$(".addnum").eq(n).val()*t),$.get("http://localhost:"+o,function(a){s?((a=JSON.parse(a.cartData))[n].price=$(".addnum").eq(n).val()*t,a[n].num=$(".addnum").eq(n).val(),a=JSON.stringify(a),console.log(a),$.ajax({type:"patch",url:"http://localhost:"+o,data:{cartData:a},success:c})):$.ajax({type:"put",url:"http://localhost:"+o+"/"+e,data:{num:$(".addnum").eq(n).val(),price:$(".addnum").eq(n).val()*t},success:c})})}}),$(".addnum").eq(n).change(function(){var t=$(".price").eq(n).attr("data-price"),e=$(".delBtn").eq(n).attr("data-id");console.log(n,t,e),$(".allPrice").eq(n).text("￥"+$(".addnum").eq(n).val()*t),$.get("http://localhost:"+o,function(a){s?((a=JSON.parse(a.cartData))[n].price=$(".addnum").eq(n).val()*t,a[n].num=$(".addnum").eq(n).val(),a=JSON.stringify(a),console.log(a),$.ajax({type:"patch",url:"http://localhost:"+o,data:{cartData:a},success:c})):$.ajax({type:"put",url:"http://localhost:1002/"+o+"/"+e,data:{num:$(".addnum").eq(n).val(),price:$(".addnum").eq(n).val()*t},success:c})})})}),$(".allCheck input").click(function(){$.get("http://localhost:"+o,function(a){var t=$(".allCheck input").prop("checked");$(".ensure").prop("checked",t),c()})}),$(".ensure").click(function(){$.get("http://localhost:"+o,function(a){var t=$(".ensure:checked").length,e=$(".ensure").length;$(".allCheck input").prop("checked",t==e),c()})})})}var a=JSON.parse(localStorage.getItem("userData"));a?$.get("http://localhost:1003/userData/"+a.id,function(a){var t=JSON.parse(a.cartData);console.log(t),e(t)}):$.get("http://localhost:1002/data",function(a){e(a)})});